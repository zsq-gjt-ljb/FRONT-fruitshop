"use strict";const t=require("./common/vendor.js"),e=require("./utils/request.js"),n={__name:"DiscountManage",setup(n){const o=t.ref([]),i={1:"普通会员",2:"白银会员",3:"黄金会员",4:"钻石会员"},s=async()=>{try{const n=await e.request({url:"https://bgnc.online/api/discount/",method:"GET"});200===n.code&&n.data?(console.log("获取到的折扣数据:",n.data),o.value=n.data.map((t=>({...t,discount:10*parseFloat(t.discount),inputValue:(10*parseFloat(t.discount)).toString(),originalDiscount:10*parseFloat(t.discount),saving:!1,changed:!1})))):t.index.showToast({title:n.msg||"获取折扣数据失败",icon:"none"})}catch(n){console.error("获取折扣数据失败:",n),t.index.showToast({title:"网络错误，请稍后再试",icon:"none"})}};return t.onMounted((()=>{s()})),(n,a)=>({a:t.f(o.value,((n,o,a)=>{return{a:t.t(n.memberLevel),b:t.n(`level-${n.memberLevel}`),c:t.t((c=n.memberLevel,i[c]||"未知等级")),d:t.o([t=>n.inputValue=t.detail.value,o,t=>(t=>{let e=t.inputValue;e=e.replace(/[^\d.]/g,"");const n=e.split(".");n.length>2&&(e=n[0]+"."+n.slice(1).join("")),2===n.length&&n[1].length>1&&(e=n[0]+"."+n[1].substring(0,1));let o=parseFloat(e);isNaN(o)||(o>10&&(e="10"),o<0&&(e="0")),t.inputValue=e;const i=parseFloat(e)||0;t.discount=i,t.changed=i!==t.originalDiscount})(n),o],o),e:t.o((t=>(t=>{""===t.inputValue&&(t.inputValue="0",t.discount=0,t.changed=0!==t.originalDiscount)})(n)),o),f:n.inputValue,g:t.t(n.discount),h:t.t(n.saving?"保存中...":"更新"),i:t.o((o=>(async n=>{n.saving=!0;const o=n.discount;try{const i=(parseFloat(n.discount)/10).toFixed(2).toString();t.index.showLoading({title:"保存中"});const a=await e.request({url:`https://bgnc.online/api/discount/?memberLevel=${parseInt(n.memberLevel)}&discount=${i}`,method:"PUT"});200===a.code?(t.index.showToast({title:"保存成功",icon:"success"}),await s()):(n.discount=o,n.inputValue=o.toString(),t.index.showToast({title:a.msg||"保存失败",icon:"none"}))}catch(i){console.error("保存折扣设置失败:",i),n.discount=o,n.inputValue=o.toString(),t.index.showToast({title:"网络错误，请稍后再试",icon:"none"})}finally{t.index.hideLoading(),n.saving=!1}})(n)),o),j:n.saving||!n.changed,k:n.saving,l:o};var c}))})}};exports._sfc_main=n;
