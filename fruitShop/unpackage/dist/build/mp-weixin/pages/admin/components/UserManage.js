"use strict";const e=require("../../../common/vendor.js"),a=require("../../../utils/request.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons.js")+(()=>"../../../node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup.js"))();const l={__name:"UserManage",setup(l){e.ref("");const o=e.ref(!1),t=["全部等级","VIP1","VIP2","VIP3"],u=e.ref(0),n=e.ref(1),s=e.ref(1),i=e.ref(5),r=e.ref(1),v=e.ref(0),c=e.ref(null),d=e.ref([]),p=e.ref(null),m=(new Date).getFullYear(),f=Array.from({length:10},((e,a)=>(m-a).toString())),h=e.ref(0),g=e=>{h.value=e.detail.value},w=async()=>{const l=f[h.value];try{const o=await a.request({url:"https://bgnc.online/api/user/list",method:"GET",data:{pageNum:s.value,pageSize:i.value,year:l}});200===o.code&&o.data?(d.value=o.data.rows||[],v.value=o.data.total||0,r.value=Math.ceil(v.value/i.value)||1):e.index.showToast({title:o.msg||"获取数据失败",icon:"none"})}catch(o){console.error("查询用户消费失败：",o),e.index.showToast({title:"网络错误，请稍后再试",icon:"none"})}},y=async()=>{o.value=!0;try{const l=await a.request({url:"https://bgnc.online/api/user/list",method:"GET",data:{pageNum:s.value,pageSize:i.value,year:f[h.value]}});200===l.code&&l.data?(console.log("用户列表数据:",l.data),d.value=l.data.rows||[],v.value=l.data.total||0,r.value=Math.ceil(v.value/i.value)||1):e.index.showToast({title:l.msg||"获取用户列表失败",icon:"none"})}catch(l){console.error("获取用户列表失败：",l),e.index.showToast({title:"获取用户列表失败",icon:"none"})}finally{o.value=!1}},b=e=>{u.value=e.detail.value,s.value=1,y()},x=()=>{p.value.close()},T=async()=>{if(c.value)try{const l=await a.request({url:"https://bgnc.online/api/usermember/level",method:"PUT",data:{userId:c.value.id,memberLevel:n.value}});if(0===l.code||200===l.code){e.index.showToast({title:"修改成功",icon:"success"});const a=d.value.findIndex((e=>e.id===c.value.id));-1!==a&&(d.value[a].memberLevel=n.value),p.value.close()}else e.index.showToast({title:l.message||"修改失败",icon:"none"})}catch(l){console.error("修改用户等级失败：",l),e.index.showToast({title:"修改用户等级失败",icon:"none"})}},q=()=>{s.value>1&&(s.value--,y())},I=()=>{s.value<r.value&&(s.value++,y())};return e.onMounted((()=>{y()})),(a,l)=>e.e({a:e.t(e.unref(f)[h.value]),b:e.unref(f),c:h.value,d:e.o(g),e:e.o(w),f:e.t(t[u.value]),g:t,h:u.value,i:e.o(b),j:o.value},o.value?{k:e.p({type:"spinner-cycle",size:"30",color:"#4a90e2"})}:0===d.value.length?{}:{m:e.f(d.value,((a,l,o)=>({a:a.userAvatar||"/static/images/default-avatar.png",b:e.t(a.userName||"未设置昵称"),c:e.t(a.phone||"未绑定手机"),d:e.t(a.memberLevel||1),e:e.t("1"===a.userSex?"男":"2"===a.userSex?"女":"未知"),f:e.t(a.consumeQuota||"0.00"),g:(a.memberLevel||1)-1,h:e.o((e=>((e,a)=>{const l=parseInt(e.detail.value)+1;c.value=a,n.value=l,p.value.open()})(e,a)),a.id),i:a.id}))),n:t.slice(1)},{l:0===d.value.length,o:1===s.value?1:"",p:e.o(q),q:e.t(s.value),r:e.t(r.value),s:s.value===r.value||0===r.value?1:"",t:e.o(I),v:e.t(n.value),w:e.o(x),x:e.o(T),y:e.sr(p,"0c80738b-1",{k:"confirmPopup"}),z:e.p({type:"dialog"})})}};wx.createComponent(l);
