"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),a=require("../../utils/request.js");if(!Array){e.resolveComponent("uni-icons")()}Math;const n={__name:"user",setup(n){const o=e.ref({userAvatar:"",userName:"",memberLevel:1,userRole:""}),s=e.ref(!1);e.ref([{type:"pending-payment",name:"待支付",icon:"/static/icons/payment.png",count:0},{type:"undelivered",name:"待发货",icon:"/static/icons/box.png",count:0},{type:"delivered",name:"待收货",icon:"/static/icons/truck.png",count:0},{type:"after-sale",name:"退款/售后",icon:"/static/icons/refound.png",count:0}]);const r=e.computed((()=>{const e=[{id:1,name:"收货地址",icon:"/static/icons/location.png",path:"/pages/address/edit"},{id:2,name:"个人设置",icon:"/static/icons/setting.png",path:"/pages/settings/index"},{id:3,name:"联系客服",icon:"/static/icons/service.png",type:"customer-service"}];return"admin"===o.value.userRole&&e.push({id:4,name:"管理后台",icon:"/static/icons/admin.png",path:"/pages/admin/index"}),e})),i=()=>e.index.getStorageSync("token")?(s.value=!1,!1):(s.value=!0,!0),c=()=>!!s.value&&(e.index.showModal({title:"需要登录",content:"该功能需要登录后才能使用，是否立即登录？",success:t=>{if(t.confirm){const t="/"+getCurrentPages()[getCurrentPages().length-1].route;e.index.navigateTo({url:"/pages/login/login?redirect="+encodeURIComponent(t)})}}}),!0),u=()=>{const t="/"+getCurrentPages()[getCurrentPages().length-1].route;e.index.navigateTo({url:"/pages/login/login?redirect="+encodeURIComponent(t)})},d=async()=>{if(!s.value)try{const t=await a.request({url:"https://bgnc.online/api/user/profile",method:"GET"});200===t.code&&(console.log("res.data是",t.data),o.value={userAvatar:t.data.userAvatar,userName:t.data.userName,memberLevel:t.data.memberLevel||1,userRole:t.data.userRole,id:t.data.id,userSex:t.data.userSex,userBirthday:t.data.userBirthday,phone:t.data.phone,status:t.data.status,openId:t.data.openId},console.log("处理后的用户信息:",o.value),e.index.setStorageSync("userAvatar",t.data.userAvatar),e.index.setStorageSync("userName",t.data.userName),e.index.setStorageSync("userRole",t.data.userRole))}catch(t){console.error("获取用户信息失败：",t)}},l=t=>{if(c())return;let a="";switch(t){case"pending-payment":a=0;break;case"undelivered":a=1;break;case"delivered":a=2;break;case"completed":a=3;break;case"after-sale":a=4}e.index.navigateTo({url:`/pages/order/list?status=${a}`})},p=()=>{c()||e.index.navigateTo({url:"/pages/settings/index",fail:t=>{console.error("跳转到个人设置页面失败：",t),e.index.showToast({title:"页面跳转失败",icon:"none"})}})};return e.onMounted((()=>{i(),s.value||d()})),e.onShow((()=>{i(),s.value||d()})),(a,n)=>e.e({a:s.value?"/static/images/default-avatar.png":o.value.userAvatar||"/static/images/default-avatar.png",b:e.t(s.value?"游客":o.value.userName||"微信用户"),c:!s.value},s.value?{}:{d:t._imports_0$3,e:e.t(o.value.memberLevel||1)},{f:s.value},s.value?{g:e.o(u)}:{},{h:e.o(p),i:e.p({type:"right",size:"14",color:"#999"}),j:e.o((e=>l(""))),k:t._imports_1$1,l:e.o((e=>l("pending-payment"))),m:t._imports_2$1,n:e.o((e=>l("undelivered"))),o:t._imports_3,p:e.o((e=>l("delivered"))),q:t._imports_4,r:e.o((e=>l("completed"))),s:t._imports_5,t:e.o((e=>l("after-sale"))),v:e.f(r.value,((t,a,n)=>({a:t.icon,b:e.t(t.name),c:t.id,d:e.o((a=>(t=>{c()||("customer-service"!==t.type?"管理后台"!==t.name?e.index.navigateTo({url:t.path,fail:t=>{console.error("跳转失败：",t),e.index.showToast({title:"页面跳转失败",icon:"none"})}}):e.index.showModal({title:"提示",content:"确认进入管理后台？",success:a=>{a.confirm&&e.index.navigateTo({url:t.path,fail:t=>{console.error("跳转失败：",t),e.index.showToast({title:"页面跳转失败",icon:"none"})}})}}):e.index.navigateTo({url:"/pages/user/contact",fail:t=>{console.error("跳转到联系客服页面失败：",t),e.index.showToast({title:"页面跳转失败",icon:"none"})}}))})(t)),t.id)})))})}};wx.createPage(n);
