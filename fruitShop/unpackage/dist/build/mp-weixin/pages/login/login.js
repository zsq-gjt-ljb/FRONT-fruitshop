"use strict";const e=require("../../common/vendor.js"),o=require("../../utils/request.js"),n=require("../../common/assets.js"),i={name:"Login",setup(){const n=e.ref({phone:"",password:""}),i=e.ref(!1),a=e.ref("");e.onLoad((e=>{console.log("登录页面参数:",e),e.redirect&&(a.value=decodeURIComponent(e.redirect),console.log("获取到重定向URL:",a.value))})),e.onMounted((()=>{console.log("登录页面已加载完成"),i.value=!1}));return{isDev:!1,form:n,isAgreed:i,checkboxChange:e=>{i.value=e.detail.value.length>0},navigateToUserAgreement:()=>{e.index.navigateTo({url:"/pages/agreement/user-agreement"})},navigateToPrivacyPolicy:()=>{e.index.navigateTo({url:"/pages/agreement/privacy-policy"})},handleWechatLogin:()=>{console.log("点击了微信登录按钮"),i.value?(e.index.showLoading({title:"登录中..."}),e.index.login({provider:"weixin",success:async n=>{try{const t=await o.request({url:"https://bgnc.online/api/auth/login",method:"POST",data:{xcxCode:n.code,grantType:"xcx"}});if(e.index.hideLoading(),200===t.code){e.index.setStorageSync("token",t.data.access_token),e.index.removeStorageSync("isGuestMode");try{const e=await o.request({url:"https://bgnc.online/api/order/route?phoneNumber=5713&orderNumber=SF3165555559187",method:"GET"});console.log("路由查询结果:",e)}catch(i){console.error("路由查询失败:",i)}e.index.showToast({title:"登录成功",icon:"success",duration:1500}),setTimeout((()=>{(()=>{if(console.log("处理导航跳转, 重定向URL:",a.value),a.value)["/pages/index/index","/pages/category/category","/pages/cart/cart","/pages/user/user"].includes(a.value)?(console.log("跳转到tabBar页面:",a.value),e.index.switchTab({url:a.value,fail:o=>{console.error("跳转失败:",o),e.index.switchTab({url:"/pages/index/index"})}})):(console.log("跳转到非tabBar页面:",a.value),e.index.navigateTo({url:a.value,fail:o=>{console.error("跳转失败:",o),e.index.switchTab({url:"/pages/index/index"})}}));else{console.log("无重定向URL，跳转到首页");try{e.index.switchTab({url:"/pages/index/index",fail:o=>{console.error("跳转到首页失败:",o),e.index.reLaunch({url:"/pages/index/index"})}})}catch(i){console.error("跳转异常:",i),e.index.reLaunch({url:"/pages/index/index"})}}})()}),1600)}else e.index.showToast({title:t.message||"登录失败",icon:"none"})}catch(i){e.index.hideLoading(),e.index.showToast({title:"登录失败，请稍后再试",icon:"none"}),console.error("微信登录失败：",i)}},fail:o=>{e.index.hideLoading(),e.index.showToast({title:"微信登录失败",icon:"none"}),console.error("微信登录API调用失败:",o)}})):e.index.showToast({title:"请阅读并同意用户协议和隐私政策",icon:"none",duration:2e3})},handleGuestLogin:()=>{console.log("点击了游客模式按钮"),e.index.setStorageSync("isGuestMode",!0),e.index.showToast({title:"以游客身份浏览",icon:"success",duration:1500}),setTimeout((()=>{e.index.switchTab({url:"/pages/index/index",fail:o=>{console.error("跳转到首页失败:",o),e.index.reLaunch({url:"/pages/index/index"})}})}),1600)},devNavigateTo:o=>{e.index.setStorageSync("token","dev_token"),e.index.setStorageSync("userInfo",{level:1}),e.index.switchTab({url:o})}}}};const a=e._export_sfc(i,[["render",function(o,i,a,t,r,s){return{a:n._imports_0$1,b:t.isAgreed,c:e.o(((...e)=>t.navigateToUserAgreement&&t.navigateToUserAgreement(...e))),d:e.o(((...e)=>t.navigateToPrivacyPolicy&&t.navigateToPrivacyPolicy(...e))),e:e.o(((...e)=>t.checkboxChange&&t.checkboxChange(...e))),f:e.o(((...e)=>t.handleWechatLogin&&t.handleWechatLogin(...e))),g:e.o(((...e)=>t.handleGuestLogin&&t.handleGuestLogin(...e)))}}]]);wx.createPage(a);
