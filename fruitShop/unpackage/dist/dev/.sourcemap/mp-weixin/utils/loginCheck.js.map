{"version":3,"file":"loginCheck.js","sources":["utils/loginCheck.js"],"sourcesContent":["/**\r\n * 检查用户是否已登录，如果未登录则提示并可选择跳转到登录页\r\n * @param {Object} options - 配置选项\r\n * @param {Boolean} options.showModal - 是否显示登录提示框，默认为true\r\n * @param {Boolean} options.autoNavigate - 如果showModal为false，是否自动跳转到登录页，默认为false\r\n * @param {String} options.redirectUrl - 登录后重定向的地址，默认为当前页面\r\n * @returns {Boolean} - 返回用户是否已登录\r\n */\r\nconst checkLogin = (options = {}) => {\r\n  // 默认配置\r\n  const defaultOptions = {\r\n    showModal: true,\r\n    autoNavigate: false,\r\n    redirectUrl: ''\r\n  };\r\n  \r\n  // 合并配置\r\n  const finalOptions = { ...defaultOptions, ...options };\r\n  \r\n  // 检查token是否存在\r\n  const token = uni.getStorageSync('token');\r\n  \r\n  // 如果token存在，表示已登录\r\n  if (token) {\r\n    return true;\r\n  }\r\n  \r\n  // 获取当前页面作为重定向URL\r\n  let redirectPage = finalOptions.redirectUrl;\r\n  if (!redirectPage) {\r\n    const pages = getCurrentPages();\r\n    const currentPage = pages[pages.length - 1];\r\n    redirectPage = '/' + currentPage.route;\r\n  }\r\n  \r\n  // 如果未登录且需要显示提示\r\n  if (finalOptions.showModal) {\r\n    uni.showModal({\r\n      title: '需要登录',\r\n      content: '该功能需要登录后才能使用，是否前往登录？',\r\n      success: (res) => {\r\n        if (res.confirm) {\r\n          // 导航到登录页并传递重定向URL\r\n          uni.navigateTo({\r\n            url: '/pages/login/login?redirect=' + encodeURIComponent(redirectPage)\r\n          });\r\n        }\r\n      }\r\n    });\r\n  } else if (finalOptions.autoNavigate) {\r\n    // 自动导航到登录页\r\n    uni.navigateTo({\r\n      url: '/pages/login/login?redirect=' + encodeURIComponent(redirectPage)\r\n    });\r\n  }\r\n  \r\n  // 返回未登录状态\r\n  return false;\r\n};\r\n\r\n/**\r\n * 退出登录\r\n */\r\nconst logout = () => {\r\n  // 清除登录凭证\r\n  uni.removeStorageSync('token');\r\n  \r\n  // 设置为游客模式\r\n  uni.setStorageSync('isGuestMode', true);\r\n  \r\n  // 跳转回首页\r\n  uni.switchTab({\r\n    url: '/pages/index/index'\r\n  });\r\n  \r\n  // 显示提示\r\n  uni.showToast({\r\n    title: '已退出登录',\r\n    icon: 'success'\r\n  });\r\n};\r\n\r\nexport default {\r\n  checkLogin,\r\n  logout\r\n}; "],"names":["uni"],"mappings":";;AAQA,MAAM,aAAa,CAAC,UAAU,OAAO;AAEnC,QAAM,iBAAiB;AAAA,IACrB,WAAW;AAAA,IACX,cAAc;AAAA,IACd,aAAa;AAAA,EACjB;AAGE,QAAM,eAAe,EAAE,GAAG,gBAAgB,GAAG,QAAO;AAGpD,QAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAGxC,MAAI,OAAO;AACT,WAAO;AAAA,EACR;AAGD,MAAI,eAAe,aAAa;AAChC,MAAI,CAAC,cAAc;AACjB,UAAM,QAAQ;AACd,UAAM,cAAc,MAAM,MAAM,SAAS,CAAC;AAC1C,mBAAe,MAAM,YAAY;AAAA,EAClC;AAGD,MAAI,aAAa,WAAW;AAC1BA,kBAAAA,MAAI,UAAU;AAAA,MACZ,OAAO;AAAA,MACP,SAAS;AAAA,MACT,SAAS,CAAC,QAAQ;AAChB,YAAI,IAAI,SAAS;AAEfA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK,iCAAiC,mBAAmB,YAAY;AAAA,UACjF,CAAW;AAAA,QACF;AAAA,MACF;AAAA,IACP,CAAK;AAAA,EACL,WAAa,aAAa,cAAc;AAEpCA,kBAAAA,MAAI,WAAW;AAAA,MACb,KAAK,iCAAiC,mBAAmB,YAAY;AAAA,IAC3E,CAAK;AAAA,EACF;AAGD,SAAO;AACT;AAKA,MAAM,SAAS,MAAM;AAEnBA,sBAAI,kBAAkB,OAAO;AAG7BA,gBAAAA,MAAI,eAAe,eAAe,IAAI;AAGtCA,gBAAAA,MAAI,UAAU;AAAA,IACZ,KAAK;AAAA,EACT,CAAG;AAGDA,gBAAAA,MAAI,UAAU;AAAA,IACZ,OAAO;AAAA,IACP,MAAM;AAAA,EACV,CAAG;AACH;AAEA,MAAe,aAAA;AAAA,EACb;AAAA,EACA;AACF;;"}